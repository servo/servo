# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at https://mozilla.org/MPL/2.0/.

# DOM Bindings Configuration.
#
# The WebIDL interfaces are defined in dom/webidls. For each such interface,
# there is a corresponding entry in the configuration table below.
# The configuration table maps each interface name to a |descriptor|.
#
# Valid fields for all descriptors:
#   * outerObjectHook: string to use in place of default value for outerObject and thisObject
#                      JS class hooks

DOMInterfaces = {

'AbstractRange': {
    'weakReferenceable': True,
},

'AudioBuffer': {
    'canGc':['CopyToChannel', 'GetChannelData'],
},

'AudioContext': {
    'inRealms': ['Close', 'Suspend'],
    'canGc':['CreateMediaStreamDestination', 'CreateMediaElementSource', 'CreateMediaStreamSource', 'CreateMediaStreamTrackSource', 'Suspend', 'Close'],
},

'BaseAudioContext': {
    'inRealms': ['DecodeAudioData', 'Resume', 'ParseFromString', 'GetBounds', 'GetClientRects'],
    'canGc': ['CreateChannelMerger', 'CreateOscillator', 'CreateStereoPanner', 'CreateGain', 'CreateIIRFilter', 'CreateBiquadFilter', 'CreateBufferSource', 'CreateAnalyser', 'CreatePanner', 'CreateChannelSplitter', 'CreateBuffer', 'CreateConstantSource', 'Resume', 'DecodeAudioData'],
},

'Blob': {
    'weakReferenceable': True,
    'canGc': ['Slice', 'Text', 'ArrayBuffer', 'Stream', 'Bytes'],
    'inRealms': ['Bytes'],
},

'Bluetooth': {
    'inRealms': ['GetAvailability', 'RequestDevice'],
    'canGc': ['RequestDevice', 'GetAvailability'],
},

'BluetoothDevice': {
    'inRealms': ['WatchAdvertisements'],
    'canGc': ['WatchAdvertisements'],
},

'BluetoothRemoteGATTCharacteristic': {
    'inRealms': ['ReadValue', 'StartNotifications', 'StopNotifications', 'WriteValue'],
    'canGc': ['GetDescriptor', 'GetDescriptors', 'ReadValue', 'StartNotifications', 'StopNotifications', 'WriteValue'],
},

'BluetoothRemoteGATTDescriptor': {
    'inRealms': ['ReadValue', 'WriteValue'],
    'canGc': ['ReadValue', 'WriteValue'],
},

'BluetoothRemoteGATTServer': {
    'inRealms': ['Connect'],
    'canGc': ['GetPrimaryService', 'GetPrimaryServices', 'Connect', 'Disconnect'],
},

'BluetoothRemoteGATTService': {
    'canGc': ['GetCharacteristic', 'GetCharacteristics', 'GetIncludedService', 'GetIncludedServices'],
},

'ByteLengthQueuingStrategy': {
    'canGc': ['GetSize'],
},

'CanvasGradient': {
    'canGc': ['AddColorStop'],
},

'CanvasRenderingContext2D': {
    'canGc': ['GetTransform','GetImageData', 'CreateImageData', 'CreateImageData_', 'SetFont', 'FillText', 'MeasureText', 'SetStrokeStyle', 'SetFillStyle', 'SetShadowColor'],
},

'CharacterData': {
    'canGc': ['Before', 'After', 'ReplaceWith']
},

'CountQueuingStrategy': {
    'canGc': ['GetSize'],
},

'CSSStyleDeclaration': {
    'canGc': ['RemoveProperty', 'SetCssText', 'GetPropertyValue', 'SetProperty', 'CssFloat', 'SetCssFloat']
},

'CustomElementRegistry': {
    'inRealms': ['WhenDefined'],
    'canGc': ['Define', 'WhenDefined'],
},

'DataTransfer': {
    'canGc': ['Files']
},

'DataTransferItem': {
    'canGc': ['GetAsFile']
},

'DataTransferItemList': {
    'canGc': ['IndexedGetter', 'Add', 'Add_']
},

'Document': {
    'additionalTraits': ["crate::dom::document::DocumentHelpers<Self>"],
    'canGc': ['Close', 'CreateElement', 'CreateElementNS', 'ImportNode', 'SetTitle', 'Write', 'Writeln', 'CreateEvent', 'CreateRange', 'Open', 'Open_', 'CreateComment', 'CreateAttribute', 'CreateAttributeNS', 'CreateDocumentFragment', 'CreateTextNode', 'CreateCDATASection', 'CreateProcessingInstruction', 'Prepend', 'Append', 'ReplaceChildren', 'SetBgColor', 'SetFgColor', 'Fonts', 'ElementFromPoint', 'ElementsFromPoint', 'ExitFullscreen', 'CreateExpression', 'CreateNSResolver', 'Evaluate'],
},

'DocumentFragment': {
    'canGc': ['Prepend', 'Append', 'ReplaceChildren']
},

'DocumentType': {
    'canGc': ['Before', 'After', 'ReplaceWith']
},

'DOMImplementation': {
    'canGc': ['CreateDocument', 'CreateHTMLDocument', 'CreateDocumentType'],
},

'DOMMatrix': {
    'canGc': ['FromMatrix', 'FromFloat32Array', 'FromFloat64Array'],
},

'DOMMatrixReadOnly': {
    'canGc': ['Multiply', 'Inverse', 'Scale', 'Translate', 'Rotate', 'RotateFromVector','FlipY', 'ScaleNonUniform', 'Scale3d', 'RotateAxisAngle', 'SkewX', 'SkewY', 'FlipX', 'TransformPoint', 'FromFloat32Array', 'FromFloat64Array', 'FromMatrix', 'ToFloat32Array', 'ToFloat64Array'],
},

'DOMParser': {
    'canGc': ['ParseFromString'],
},

'DOMPoint': {
    'canGc': ['FromPoint'],
},

'DOMPointReadOnly': {
    'canGc': ['FromPoint'],
},

'DOMQuad': {
    'canGc': ['FromRect', 'FromQuad', 'GetBounds'],
},

'DOMStringMap': {
    'canGc': ['NamedSetter']
},

"DOMTokenList": {
     'canGc': ['SetValue', 'Add', 'Remove', 'Toggle', 'Replace']
},

'DynamicModuleOwner': {
    'inRealms': ['PromiseAttribute'],
},

'Element': {
    'canGc': ['SetInnerHTML', 'SetOuterHTML', 'InsertAdjacentHTML', 'GetClientRects', 'GetBoundingClientRect', 'InsertAdjacentText', 'ToggleAttribute', 'SetAttribute', 'SetAttributeNS', 'SetId','SetClassName','Prepend','Append','ReplaceChildren','Before','After','ReplaceWith', 'SetRole', 'SetAriaAtomic', 'SetAriaAutoComplete', 'SetAriaBrailleLabel', 'SetAriaBrailleRoleDescription', 'SetAriaBusy', 'SetAriaChecked', 'SetAriaColCount', 'SetAriaColIndex', 'SetAriaColIndexText', 'SetAriaColSpan', 'SetAriaCurrent', 'SetAriaDescription', 'SetAriaDisabled', 'SetAriaExpanded', 'SetAriaHasPopup', 'SetAriaHidden', 'SetAriaInvalid', 'SetAriaKeyShortcuts', 'SetAriaLabel', 'SetAriaLevel', 'SetAriaLive', 'SetAriaModal', 'SetAriaMultiLine', 'SetAriaMultiSelectable', 'SetAriaOrientation', 'SetAriaPlaceholder', 'SetAriaPosInSet', 'SetAriaPressed','SetAriaReadOnly', 'SetAriaRelevant', 'SetAriaRequired', 'SetAriaRoleDescription', 'SetAriaRowCount', 'SetAriaRowIndex', 'SetAriaRowIndexText', 'SetAriaRowSpan', 'SetAriaSelected', 'SetAriaSetSize','SetAriaSort', 'SetAriaValueMax', 'SetAriaValueMin', 'SetAriaValueNow', 'SetAriaValueText', 'SetScrollTop', 'SetScrollLeft', 'Scroll', 'Scroll_', 'ScrollBy', 'ScrollBy_', 'ScrollWidth', 'ScrollHeight', 'ScrollTop', 'ScrollLeft', 'ClientTop', 'ClientLeft', 'ClientWidth', 'ClientHeight', 'RequestFullscreen'],
},

'ElementInternals': {
    'canGc': ['CheckValidity', 'ReportValidity'],
},

'EventSource': {
    'weakReferenceable': True,
},

'EventTarget': {
    'canGc': ['DispatchEvent'],
},

'FakeXRDevice': {
    'canGc': ['Disconnect'],
},

'File': {
    'weakReferenceable': True,
},

'FileReader': {
    'canGc': ['Abort'],
},

'FileReaderSync': {
    'canGc': ['ReadAsArrayBuffer'],
},

'FontFaceSet': {
    'canGc': ['Load'],
},

'GamepadHapticActuator': {
    'inRealms': ['PlayEffect', 'Reset'],
    'canGc': ['PlayEffect', 'Reset'],
},

'GlobalScope': {
    'additionalTraits': ['crate::dom::globalscope::GlobalScopeHelpers<Self>'],
},

'GPU': {
    'inRealms': ['RequestAdapter'],
    'canGc': ['RequestAdapter', 'WgslLanguageFeatures'],
},

'GPUAdapter': {
    'inRealms': ['RequestAdapterInfo', 'RequestDevice'],
    'canGc': ['RequestAdapterInfo', 'RequestDevice'],
},

'GPUBuffer': {
    'inRealms': ['MapAsync'],
    'canGc': ['GetMappedRange', 'MapAsync'],
},

'GPUCanvasContext': {
    'weakReferenceable': True,
},

'GPUDevice': {
    'inRealms': [
        'CreateComputePipelineAsync',
        'CreateRenderPipelineAsync',
        'CreateShaderModule', # Creates promise for compilation info
        'PopErrorScope'
    ],
    'canGc': [
        'CreateComputePipelineAsync',
        'CreateRenderPipelineAsync',
        'CreateShaderModule',
        'PopErrorScope'
    ],
    'weakReferenceable': True, # for usage in GlobalScope https://github.com/servo/servo/issues/32519
},

'GPUQueue': {
    'canGc': ['OnSubmittedWorkDone'],
},

'History': {
    'canGc': ['Go'],
},

"HTMLAnchorElement": {
    "canGc": ["SetText","SetRel","SetHref", 'SetHash', 'SetHost', 'SetHostname', 'SetPassword', 'SetPathname', 'SetPort', 'SetProtocol', 'SetSearch', 'SetUsername']
},

"HTMLAreaElement": {
     "canGc": ['SetText', 'SetRel', 'SetHref', 'SetHash', 'SetHost', 'SetHostname', 'SetPassword', 'SetPathname', 'SetPort', 'SetProtocol', 'SetSearch', 'SetUsername']
},

"HTMLBodyElement": {
    "canGc": ["SetBackground"]
},

'HTMLButtonElement': {
    'canGc': ['CheckValidity', 'ReportValidity','SetBackground'],
},

'HTMLCanvasElement': {
    'canGc': ['CaptureStream', 'GetContext'],
},

'HTMLDialogElement': {
    'canGc': ['Show'],
},

'HTMLElement': {
    'canGc': ['Focus', 'Blur', 'Click', 'SetInnerText', 'SetOuterText', "SetTranslate", 'SetAutofocus', 'GetOffsetParent', 'OffsetTop', 'OffsetLeft', 'OffsetWidth', 'OffsetHeight', 'InnerText', 'GetOuterText', 'GetOnerror', 'GetOnload', 'GetOnblur', 'GetOnfocus', 'GetOnresize', 'GetOnscroll'],
},

'HTMLFieldSetElement': {
    'canGc': ['CheckValidity', 'ReportValidity'],
},

'HTMLFontElement': {
    'canGc': ['SetSize']
},

'HTMLFormElement': {
    'canGc': ['CheckValidity', 'RequestSubmit', 'ReportValidity', 'Submit', 'Reset', 'SetRel'],
},

'HTMLImageElement': {
    'canGc': ['RequestSubmit', 'ReportValidity', 'Reset','SetRel', 'Width', 'Height', 'Decode', 'SetCrossOrigin', 'SetWidth', 'SetHeight', 'SetReferrerPolicy'],
},

'HTMLInputElement': {
    'canGc': ['ReportValidity', 'SetValue', 'SetValueAsNumber', 'SetValueAsDate', 'StepUp', 'StepDown', 'CheckValidity', 'ReportValidity', 'SelectFiles'],
},

'HTMLLinkElement': {
    'canGc': ['SetRel', 'SetCrossOrigin'],
},

'HTMLMediaElement': {
    'canGc': ['Load', 'Pause', 'Play', 'SetSrcObject', 'SetCrossOrigin'],
    'inRealms': ['Play'],
},

'HTMLMeterElement': {
    'canGc': ['SetValue', 'SetMin', 'SetMax', 'SetLow', 'SetHigh', 'SetOptimum', 'CheckValidity', 'ReportValidity']
},

'HTMLObjectElement': {
    'canGc': ['CheckValidity', 'ReportValidity'],
},

'HTMLOptionElement': {
    'canGc': ['SetText']
},

'HTMLOptionsCollection': {
    'canGc': ['IndexedSetter', 'SetLength']
},

'HTMLOutputElement': {
    'canGc': ['ReportValidity', 'SetDefaultValue', 'SetValue', 'CheckValidity'],
},

'HTMLProgressElement': {
    'canGc': ['SetValue', 'SetMax']
},

'HTMLScriptElement': {
    'canGc': ['SetAsync', 'SetCrossOrigin', 'SetText']
},

'HTMLSelectElement': {
    'canGc': ['ReportValidity', 'SetLength', 'IndexedSetter', 'CheckValidity'],
},

'HTMLTableElement': {
    'canGc': ['CreateCaption', 'CreateTBody', 'InsertRow', 'InsertCell', 'InsertRow', 'CreateTHead', 'CreateTFoot']
},

'HTMLTableRowElement': {
    'canGc': ['InsertCell']
},

'HTMLTableSectionElement': {
    'canGc': ['InsertRow']
},

'HTMLTemplateElement': {
    'canGc': ['Content'],
},

'HTMLTextAreaElement': {
    'canGc': ['ReportValidity', 'SetDefaultValue', 'CheckValidity'],
},

'HTMLTitleElement': {
    'canGc': ['SetText']
},

'Location': {
    'canGc': ['Assign', 'Reload', 'Replace', 'SetHash', 'SetHost', 'SetHostname', 'SetHref', 'SetPathname', 'SetPort', 'SetProtocol', 'SetSearch'],
},

'MediaDevices': {
    'canGc': ['GetUserMedia', 'EnumerateDevices'],
    'inRealms': ['GetUserMedia', 'GetClientRects', 'GetBoundingClientRect'],
},

'MediaQueryList': {
    'weakReferenceable': True,
},

'MediaSession': {
    'canGc': ['GetMetadata'],
},

'MediaStream': {
    'canGc': ['Clone'],
},

'MessagePort': {
    'weakReferenceable': True,
    'canGc': ['GetOnmessage'],
},

'MouseEvent': {
    'canGc': ['OffsetX', 'OffsetY'],
},

'NavigationPreloadManager': {
    'inRealms': ['Disable', 'Enable', 'GetState', 'SetHeaderValue'],
    'canGc': ['Disable', 'Enable', 'GetState', 'SetHeaderValue'],
},

'Navigator': {
    'inRealms': ['GetVRDisplays'],
},

'Node': {
    'canGc': ['CloneNode', 'SetTextContent'],
},

'Notification': {
    'canGc': ['RequestPermission'],
},

'OfflineAudioContext': {
    'inRealms': ['StartRendering'],
    'canGc': ['StartRendering'],
},

'OffscreenCanvasRenderingContext2D': {
    'canGc': ['CreateImageData', 'CreateImageData_', 'GetImageData', 'GetTransform', 'SetFont', 'FillText', 'MeasureText', 'SetStrokeStyle', 'SetFillStyle', 'SetShadowColor'],
},

'PaintRenderingContext2D': {
    'canGc': ['GetTransform', 'SetStrokeStyle', 'SetFillStyle', 'SetShadowColor'],
},

'Performance': {
    'canGc': ['Mark', 'Measure'],
},

'Permissions': {
    'canGc': ['Query', 'Request', 'Revoke'],
},

'Promise': {
    'spiderMonkeyInterface': True,
    'additionalTraits': ["crate::dom::promise::PromiseHelpers<Self>"]
},

'Range': {
    'canGc': ['CloneContents', 'CloneRange', 'CreateContextualFragment', 'ExtractContents', 'SurroundContents', 'InsertNode'],
    'weakReferenceable': True,
},

'Request': {
    'canGc': ['Headers', 'Text', 'Blob', 'FormData', 'Json', 'ArrayBuffer', 'Clone', 'Bytes'],
},

'Response': {
    'canGc': ['Error', 'Redirect', 'Clone', 'Text', 'Blob', 'FormData', 'Json', 'ArrayBuffer', 'Headers', 'Bytes'],
},

'RTCPeerConnection': {
    'inRealms': ['AddIceCandidate', 'CreateAnswer', 'CreateOffer', 'SetLocalDescription', 'SetRemoteDescription'],
    'canGc': ['Close', 'AddIceCandidate', 'CreateAnswer', 'CreateOffer', 'SetLocalDescription', 'SetRemoteDescription'],
},

'RTCRtpSender': {
    'canGc': ['SetParameters'],
},

'Selection': {
    'canGc': ['Collapse', 'CollapseToEnd', 'CollapseToStart', 'Extend', 'SelectAllChildren', 'SetBaseAndExtent', 'SetPosition'],
},

'ServiceWorkerContainer': {
    'inRealms': ['Register'],
    'canGc': ['Register'],
},

'ShadowRoot': {
    'canGc': ['ElementFromPoint', 'ElementsFromPoint', 'SetInnerHTML'],
},

'StaticRange': {
    'weakReferenceable': True,
},

'SubtleCrypto': {
    'inRealms': ['Encrypt', 'Decrypt', 'Sign', 'Verify', 'GenerateKey', 'DeriveKey', 'DeriveBits', 'Digest', 'ImportKey', 'ExportKey', 'WrapKey', 'UnwrapKey'],
    'canGc': ['Encrypt', 'Decrypt', 'Sign', 'Verify', 'GenerateKey', 'DeriveKey', 'DeriveBits', 'Digest', 'ImportKey', 'ExportKey', 'WrapKey', 'UnwrapKey'],
},

'SVGElement': {
    'canGc': ['SetAutofocus']
},

#FIXME(jdm): This should be 'register': False, but then we don't generate enum types
'TestBinding': {
    'inRealms': ['PromiseAttribute', 'PromiseNativeHandler'],
    'canGc': ['InterfaceAttribute', 'GetInterfaceAttributeNullable', 'ReceiveInterface', 'ReceiveInterfaceSequence', 'ReceiveNullableInterface', 'PromiseAttribute', 'PromiseNativeHandler', 'PromiseResolveNative', 'PromiseRejectNative', 'PromiseRejectWithTypeError'],
},

'TestWorklet': {
    'inRealms': ['AddModule'],
    'canGc': ['AddModule'],
},

'Text': {
    'canGc': ['SplitText']
},

'TextEncoder': {
    'canGc': ['Encode']
},

'URL': {
    'weakReferenceable': True,
    'canGc': ['Parse', 'SearchParams'],
},

'WebGLRenderingContext': {
    'canGc': ['MakeXRCompatible'],
},

'WebGL2RenderingContext': {
    'canGc': ['MakeXRCompatible'],
},

'Window': {
    'canGc': ['Stop', 'Fetch', 'Scroll', 'Scroll_','ScrollBy', 'ScrollBy_', 'Stop', 'Fetch', 'Open', 'CreateImageBitmap'],
    'inRealms': ['Fetch', 'GetOpener'],
},

'WindowProxy' : {
    'path': 'crate::dom::windowproxy::WindowProxy',
    'register': False,
},

'WorkerGlobalScope': {
    'inRealms': ['Fetch'],
    'canGc': ['Fetch', 'CreateImageBitmap', 'ImportScripts'],
},

'Worklet': {
    'inRealms': ['AddModule'],
    'canGc': ['AddModule'],
},

'XMLHttpRequest': {
    'canGc': ['Abort', 'GetResponseXML', 'Response', 'Send'],
},

'XPathEvaluator': {
    'canGc': ['CreateExpression', 'Evaluate'],
},

'XPathExpression': {
    'canGc': ['Evaluate'],
},

'XRBoundedReferenceSpace': {
    'canGc': ['BoundsGeometry'],
},

'XRFrame': {
    'canGc': ['GetViewerPose', 'GetPose', 'GetJointPose'],
},

'XRHitTestResult': {
    'canGc': ['GetPose'],
},

'XRRay': {
    'canGc': ['Origin', 'Direction', 'Matrix'],
},

'XRReferenceSpace': {
    'canGc': ['GetOffsetReferenceSpace'],
},

'XRRigidTransform': {
    'canGc': ['Position', 'Orientation', 'Inverse', 'Matrix'],
},

'XRSession': {
    'inRealms': ['RequestReferenceSpace', 'UpdateRenderState', 'UpdateTargetFrameRate'],
    'canGc': ['End', 'RequestReferenceSpace', 'UpdateTargetFrameRate', 'RequestHitTestSource', 'GetSupportedFrameRates'],
},

'XRSystem': {
    'inRealms': ['RequestSession'],
    'canGc': ['RequestSession', 'IsSessionSupported'],
},

'XRTest': {
    'canGc': ['SimulateDeviceConnection', 'DisconnectAllDevices'],
},

'XRView': {
    'canGc': ['ProjectionMatrix'],
},

'ReadableStream': {
    'canGc': ['GetReader', 'Cancel', 'Tee'],
},

"ReadableStreamDefaultController": {
    "canGc": ["Close", "Enqueue", "Error"]
},

"ReadableStreamBYOBReader": {
    "canGc": ["Cancel", "Read", "ReleaseLock"]
},

"ReadableStreamDefaultReader": {
    "canGc": ["Cancel", "Read", "ReleaseLock"]
},

'WritableStream': {
    'canGc': ['Abort', 'Close', 'GetWriter'],
    'inRealms': ['Abort', 'Close', 'GetWriter'],
},

'WritableStreamDefaultController': {
    'canGc': ['Error'],
    'inRealms': ['Error'],
},

'WritableStreamDefaultWriter': {
    'canGc': ['Abort', 'Close', 'Write', 'ReleaseLock'],
    'inRealms': ['Abort', 'Close', 'Write'],
},

}

Dictionaries = {
'FontFaceDescriptors': {
    'derives': ['Clone', 'MallocSizeOf']
},

'GPUCanvasConfiguration': {
    'derives': ['Clone']
},

'GPUExtent3DDict': {
    'derives': ["MallocSizeOf"],
},

'GPUObjectDescriptorBase': {
    'derives': ['MallocSizeOf']
},

'GPUTextureDescriptor': {
    'derives': ["MallocSizeOf"],
},

'HeadersInit': {
    'derives': ["Clone"],
},
}

Enums = {
'GPUFeatureName': {
    'derives': ['Eq', 'Hash', ]
},
'PermissionName': {
    'derives': ['Eq', 'Hash']
}
}

Unions = {
'ByteStringSequenceSequenceOrByteStringByteStringRecord': {
    'derives': ['Clone']
},

'ElementOrDocument': {
    'derives': ['Clone', 'MallocSizeOf']
},

'HTMLCanvasElementOrOffscreenCanvas': {
    'derives': ['Clone', 'MallocSizeOf']
},

'RangeEnforcedUnsignedLongSequenceOrGPUExtent3DDict': {
    'derives': ['MallocSizeOf']
},

'StringOrUnsignedLong': {
    'derives': ['Clone'],
},
}
