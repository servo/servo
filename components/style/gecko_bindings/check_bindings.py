# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

import re

LICENSE = """/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

/* automatically generated by check_bindings.py. */

"""

BINDINGS_FILE = "bindings.rs"
OUTPUT_FILE = "check_bindings.rs"

TEMPLATE = "    [ Servo_{name}, bindings::Servo_{name} ];\n"

with open(BINDINGS_FILE, "r") as bindings, open(OUTPUT_FILE, "w+") as tests:
    tests.write(LICENSE)
    tests.write("fn assert_types() {\n")

    pattern = re.compile("fn\s*Servo_([a-zA-Z0-9]+)\s*\(")

    for line in bindings:
        match = pattern.search(line)

        if match:
            tests.write(TEMPLATE.format(name=match.group(1)))

    tests.write("}\n")

