name: 'Runner Select'
description: 'Select a runner based on the event type'
outputs:
  runner:
    description: 'The runner to use'
    value: ${{ steps.select.outputs.runner }}
runs:
  using: composite
  steps:
    - name: Select runner
      id: select
      shell: bash
      env:
        GITHUB_EVENT_NAME: ${{ github.event_name }}
        GITHUB_REPOSITORY: ${{ github.repository }}
        GITHUB_REF: ${{ github.ref }}
        GITHUB_HEAD_REF: ${{ github.head_ref }}
        GITHUB_BASE_REF: ${{ github.base_ref }}
        PR_LABELS: ${{ toJSON(github.event.pull_request.labels.*.name) }}
      run: |
        # Default to GitHub-hosted runners
        RUNNER="ubuntu-latest"
        
        # Check if this is a pull request
        if [ "$GITHUB_EVENT_NAME" = "pull_request" ] || [ "$GITHUB_EVENT_NAME" = "pull_request_target" ]; then
          # Check if PR has the 'performance' label
          if echo "$PR_LABELS" | grep -q "performance"; then
            RUNNER="self-hosted"
          fi
        fi
        
        # Check if this is a push to main/master
        if [ "$GITHUB_EVENT_NAME" = "push" ]; then
          if [ "$GITHUB_REF" = "refs/heads/main" ] || [ "$GITHUB_REF" = "refs/heads/master" ]; then
            RUNNER="self-hosted"
          fi
        fi
        
        # Check if this is a workflow_dispatch event
        if [ "$GITHUB_EVENT_NAME" = "workflow_dispatch" ]; then
          RUNNER="self-hosted"
        fi
        
        echo "runner=$RUNNER" >> $GITHUB_OUTPUT
        echo "Selected runner: $RUNNER"
