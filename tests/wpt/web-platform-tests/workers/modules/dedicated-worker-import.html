<!DOCTYPE html>
<title>DedicatedWorker: import</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>

// Starts a dedicated worker for |scriptURL| and waits until MessageEvents from
// imported modules up to |expectedNumberOfImportedModules|.
function import_test(scriptURL, expectedNumberOfImportedModules, description) {
  promise_test(() => {
    return new Promise(resolve => {
      let numberOfImportedModules = 0;
      const worker = new Worker(scriptURL, { type: 'module' });
      worker.onmessage = e => {
        if (e.data === 'LOADED')
          ++numberOfImportedModules;
        if (numberOfImportedModules === expectedNumberOfImportedModules)
          resolve();
      };
    });
  }, description);
}

// Expect 2 imports: one for the top-level script, and one for the static
// import.
import_test('resources/static-import-worker.js', 2,
            'Static import.');

// Expect 3 imports: one for the top-level script, and two for the nested static
// import.
import_test('resources/nested-static-import-worker.js', 3,
            'Nested static import.');

// Expect 3 imports: one for the top-level script, one for the static import,
// and one for the dynamic import.
import_test('resources/static-import-and-then-dynamic-import-worker.js', 3,
            'Static import and then dynamic import.');

// Expect 2 imports: one for the top-level script, and one for the dynamic
// import.
import_test('resources/dynamic-import-worker.js', 2,
            'Dynamic import.');

// Expect 3 imports: one for the top-level script, and two for the nested
// dynamic import.
import_test('resources/nested-dynamic-import-worker.js', 3,
            'Nested dynamic import.');

// Expect 3 imports: one for the top-level script, one for the dynamic import,
// and one for the static import.
import_test('resources/dynamic-import-and-then-static-import-worker.js', 3,
            'Dynamic import and then static import.');

</script>
