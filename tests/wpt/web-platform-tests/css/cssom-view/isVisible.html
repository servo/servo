<!DOCTYPE html>
<link rel=author href="mailto:jarhar@chromium.org">
<link rel=help href="https://github.com/w3c/csswg-drafts/issues/6850">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>

<div id=visibilityhidden style="visibility:hidden">hello</div>

<div style="content-visibility:hidden">
  <div id=cvhidden>hello</div>
</div>

<div style="content-visibility:auto">
  <div id=cvauto>hello</div>
</div>

<div id=displaynone style="display:none">hello</div>

<div id=opacityzero style="opacity:0">hello</div>

<div id=inert inert>hello</div>

<div style="content-visibility:hidden">
  <div id=cvhiddenchildwithupdate></div>
</div>

<div style="content-visibility:hidden" id=cvhiddenwithupdate></div>

<div style="height:10000px">spacer</div>

<div style="content-visibility:auto">
  <div id=cvautooffscreen>hello</div>
</div>

<div id=cvautocontainer>
  <div id=cvautochild></div>
</div>

<div style="content-visibility:auto">
  <div style="content-visibility:auto">
    <div id=nestedcvautochild></div>
  </div>
</div>

<script>
test(() => {
  assert_false(visibilityhidden.isVisible({
    checkVisibilityCSS: true
  }), 'checkVisibilityCSS:true');
  assert_true(visibilityhidden.isVisible({
    checkVisibilityCSS: false
  }), 'checkVisibilityCSS:false');
}, 'isVisible on visibility:hidden element.');

test(() => {
  assert_false(cvhidden.isVisible());
}, 'isVisible on content-visibility:hidden element.');

test(() => {
  assert_true(cvauto.isVisible());
}, 'isVisible on content-visibility:auto element.');

test(() => {
  assert_true(cvautooffscreen.isVisible());
}, 'isVisible on content-visibility:auto element which is outside the viewport.');

test(() => {
  assert_false(displaynone.isVisible());
}, 'isVisible on display:none element.');

test(() => {
  assert_false(opacityzero.isVisible({
    checkOpacity: true
  }), 'checkOpacity:true');
  assert_true(opacityzero.isVisible({
    checkOpacity: false
  }), 'checkOpacity:false');
}, 'isVisible on opacity:0 element.');

test(() => {
  assert_false(inert.isVisible({
    checkInert: true
  }), 'checkInert:true');
  assert_true(inert.isVisible({
    checkInert: false
  }), 'checkInert:false');
}, 'isVisible on an inert element.');

test(() => {
  cvautocontainer.style.contentVisibility = 'auto';
  cvautochild.style.visibility = 'hidden';
  assert_false(cvautochild.isVisible({checkVisibilityCSS: true}));
  cvautochild.style.visibility = 'visible';
  assert_true(cvautochild.isVisible({checkVisibilityCSS: true}));
}, 'isVisible on content-visibility:auto with visibility:hidden inside.');

test(() => {
  assert_true(nestedcvautochild.isVisible());
}, 'isVisible on nested content-visibility:auto containers reports that the content is visible.');

test(() => {
  cvhiddenchildwithupdate.getBoundingClientRect();
  assert_false(cvhiddenchildwithupdate.isVisible());
}, 'isVisible on content-visibility:hidden child after forced layout update.');

test(() => {
  cvhiddenwithupdate.getBoundingClientRect();
  assert_true(cvhiddenwithupdate.isVisible());
}, 'isVisible on content-visibility:hidden element after forced layout update.');
</script>
