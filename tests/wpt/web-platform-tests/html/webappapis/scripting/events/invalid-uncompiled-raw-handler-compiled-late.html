<!doctype html>
<meta charset="utf-8">
<title>Invalid uncompiled raw handlers should only be compiled when about to call them.</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<body>
<script>
setup({ allow_uncaught_exception: true });

test(function() {
  var events = [];
  window.onerror = function() {
    events.push("Error");
  };

  var div = document.createElement("div");
  div.addEventListener("click", function (e) { events.push("click 1") });
  div.setAttribute("onclick", "}");
  div.addEventListener("click", function (e) { events.push("click 2") });
  div.dispatchEvent(new Event("click"));
  assert_equals(div.onclick, null);
  assert_array_equals(events, ["click 1", "error", "click 2"]);
});
</script>
</body>
