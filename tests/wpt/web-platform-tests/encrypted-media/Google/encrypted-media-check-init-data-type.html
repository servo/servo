<!DOCTYPE html>
<!-- Copyright Â© 2016 Chromium authors and World Wide Web Consortium, (Massachusetts Institute of Technology, ERCIM, Keio University, Beihang). -->
<html>
    <head>
        <title>Test support of different initDataTypes.</title>
        <script src="encrypted-media-utils.js"></script>
        <script src="../../resources/testharness.js"></script>
        <script src="../../resources/testharnessreport.js"></script>
    </head>
    <body>
        <div id="log"></div>
        <script>
            function checkInitDataType(initDataType)
            {
                return isInitDataTypeSupported(initDataType).then(function(result) {
                    // If |initDataType| is not supported, simply succeed.
                    if (!result)
                        return Promise.resolve('Not supported');

                    var options = [ { initDataTypes: [initDataType] } ];
                    return navigator.requestMediaKeySystemAccess('org.w3.clearkey', options)
                        .then(function(access) {
                            return access.createMediaKeys();
                        }).then(function(mediaKeys) {
                            var mediaKeySession = mediaKeys.createSession();
                            var initData = getInitData(initDataType);
                            return mediaKeySession.generateRequest(initDataType, initData);
                        });
                });
            }

            promise_test(function()
            {
                return checkInitDataType('webm');
            }, 'Clear key support for "webm".');

            promise_test(function()
            {
                return checkInitDataType('cenc');
            }, 'Clear key support for "cenc".');

            promise_test(function()
            {
                return checkInitDataType('keyids');
            }, 'Clear key support for "keyids".');
        </script>
    </body>
</html>

