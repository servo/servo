<!DOCTYPE html>
<html class="reftest-wait">
<title>Multiple &lt;use> referencing same external resource, with revalidation required</title>
<link rel="match" href="reference/green-100x100.html">
<svg>
  <rect width="100" height="100" fill="red"/>
</svg>
<script>
  let container = document.querySelector('svg');
  function makeUse(x) {
    let use = document.createElementNS('http://www.w3.org/2000/svg', 'use');
    use.setAttribute('href', 'support/etag-max-age-zero-icons.svg#green-square');
    use.setAttribute('x', x);
    use.setAttribute('width', 50);
    use.setAttribute('height', 50);
    use.setAttribute('transform', 'scale(1, 2)');
    return use;
  }
  function insertFirstUse() {
    let use = makeUse(0);
    use.onload = insertSecondUse;
    container.appendChild(use);
  }
  function insertSecondUse() {
    let use = makeUse(50);
    use.onload = endTest;
    container.appendChild(use);
    document.body.offsetTop;
  }
  function endTest() {
    document.documentElement.classList.remove('reftest-wait');
  }
  onload = function() {
    requestAnimationFrame(insertFirstUse);
  };
</script>
