<!DOCTYPE html>
<!-- DO NOT EDIT! This test has been generated by /html/canvas/tools/gentest.py. -->
<meta charset="UTF-8">
<link rel="match" href="2d.layer.non-invertible-matrix.with-render-states.plain-layer-expected.html">
<title>Canvas test: 2d.layer.non-invertible-matrix.with-render-states.plain-layer</title>
<h1>2d.layer.non-invertible-matrix.with-render-states.plain-layer</h1>
<p class="desc">Test drawing layers when the transform is not invertible.</p>
<canvas id="canvas" width="200" height="200">
  <p class="fallback">FAIL (fallback content)</p>
</canvas>
<script>
  const canvas = new OffscreenCanvas(200, 200);
  const ctx = canvas.getContext('2d');

  ctx.fillStyle = 'blue';
  ctx.fillRect(30, 30, 50, 50);

  // Anything below will be non-rasterizable.
  ctx.scale(1, 0);

  ctx.globalAlpha = 0.8;
  ctx.globalCompositeOperation = 'multiply';
  ctx.shadowOffsetX = 0;
  ctx.shadowOffsetY = 20;
  ctx.shadowColor = 'rgba(255, 165, 0, 0.6)';
  ctx.filter = 'blur(10px)';

  // Open the layer with a non-invertible matrix. The whole layer will be
  // non-rasterizable.
  ctx.beginLayer();

  // Because the transform is global, the matrix is still non-invertible.
  ctx.fillStyle = 'rgba(225, 0, 0, 1)';
  ctx.fillRect(40, 70, 50, 50);

  // Set a valid matrix in the middle of the layer. This makes the global
  // matrix invertible again, but because because the layer was opened with a
  // non-invertible matrix, the whole layer remains non-rasterizable.
  ctx.setTransform(1, 0, 0, 1, 0, 0);

  ctx.fillStyle = 'green';
  ctx.fillRect(70, 40, 50, 50);

  ctx.endLayer();

  const outputCanvas = document.getElementById("canvas");
  outputCanvas.getContext('2d').drawImage(canvas, 0, 0);
</script>
